# 5.5 Run- & Build-instructies – Tri-Śarīra RPG

**Versie:** 0.1  
**Auteur:** Gerald (met Architect- & Game Designer-ondersteuning)  
**Status:** Praktische README voor lokaal draaien, testen en bouwen.

Doel:

- Eén **centrale uitleg** hoe je de game lokaal draait (dev-mode).  
- Hoe je tests en datavalidatie uitvoert.  
- Een basis voor toekomstige distributie-builds.

Context: ontwikkeling op **Windows 11 + WSL (Ubuntu)**, Python 3.11/3.12, git, VS Code/Codex.

---

## 1. Benodigde software

### 1.1 Verplicht

- **Git** – om de repo te clonen.  
- **Python** – 3.11 of 3.12 (bij voorkeur 3.12) op WSL/Ubuntu.  
- **PIP + venv** – standaard bij moderne Python-installaties.  
- **Pygame dependencies** – op Ubuntu:

  ```bash
  sudo apt update
  sudo apt install python3-dev python3-venv build-essential libsdl2-dev \
      libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev
  ```

### 1.2 Aanbevolen

- **VS Code** of andere editor met goede Python-ondersteuning.  
- **Tiled** (map editor) op Windows voor het bewerken van `.tmx`-maps.  
- **GitHub-account** als de repo remote op GitHub staat.

---

## 2. Repo clonen & eerste setup

### 2.1 Repo clonen (in WSL)

In WSL (Ubuntu):

```bash
cd ~/projects
git clone <GIT-URL-TRI-SARIRA-RPG> tri_sarira_rpg
cd tri_sarira_rpg
```

> Tip: houd de repo onder `~/projects/tri_sarira_rpg` en open die map vanuit Windows VS Code via de WSL-extensie.

### 2.2 Virtuele omgeving aanmaken

In de projectroot:

```bash
python -m venv .venv
source .venv/bin/activate  # WSL / bash
```

Op PowerShell (indien je daar runt):

```powershell
python -m venv .venv
.venv\Scripts\Activate.ps1
```

### 2.3 PIP bijwerken

Met de venv actief:

```bash
python -m pip install --upgrade pip
```

### 2.4 Dependencies installeren

We gaan uit van een `pyproject.toml` met een `dev`-extra:

```toml
[project.optional-dependencies]
dev = ["pytest", "ruff", "mypy", "pygame"]
```

Installatie:

```bash
pip install -e .[dev]
```

Als je dev-extras nog niet hebt ingericht:

```bash
pip install -e .
pip install pytest ruff mypy pygame
```

> Richtlijn: zo snel mogelijk de `dev`-extra inrichten zodat één command genoeg is.

---

## 3. Game draaien (dev)

### 3.1 Standaard run-command

Met geactiveerde venv in de projectroot:

```bash
python -m tri_sarira_rpg.app.main
```

Of, als je een `__main__.py` maakt op package-niveau:

```bash
python -m tri_sarira_rpg
```

### 3.2 Met run-scripts (optioneel)

Je kunt `scripts/run_dev.sh` (WSL) en `scripts/run_dev.ps1` (Windows) toevoegen die gewoon dit doen:

**`scripts/run_dev.sh`**

```bash
#!/usr/bin/env bash
set -e
source .venv/bin/activate
python -m tri_sarira_rpg.app.main
```

**`scripts/run_dev.ps1`**

```powershell
. .venv\Scripts\Activate.ps1
python -m tri_sarira_rpg.app.main
```

Dan kun je in WSL gewoon:

```bash
./scripts/run_dev.sh
```

---

## 4. Configuratie (config/)

### 4.1 Bestanden

- `config/default_config.toml` – basisinstellingen:  
  - resolutie, fullscreen/windowed, framerate, audio-volume, keybinds, data/asset-paden.  
- `config/dev.toml` – overrides voor ontwikkelmodus:  
  - `debug = true`,  
  - `skip_intro = true`,  
  - loglevel, etc.

### 4.2 Laagopbouw

`core.config.Config` leest:

1. `default_config.toml`  
2. `dev.toml` (optioneel, overschrijft defaults)  
3. eventueel env-variabelen (bv. `TSR_MODE=dev`)

> Richtlijn: als de game "raar" opstart, controleer eerst `config/dev.toml` en of dev-flags nog aanstaan.

---

## 5. Data & maps voorbereiden

Voor de vertical slice moeten minimaal:

- `data/actors.json`, `enemies.json`, `items.json`, `skills.json`,  
- `data/quests.json`, `dialogue.json`,  
- `data/npc_schedules.json`, `events.json`,  
- `data/shops.json`, `loot_tables.json`, `chests.json`, `zones.json`  
- `maps/z_r1_chandrapur_town.tmx`, `z_r1_forest_route.tmx`, `z_r1_shrine_clearing.tmx`

aanwezig zijn (al is het in beperkte vorm).

Als je nog in opbouw bent, kun je eerst de **`data/examples/*.json`** kopiëren naar de hoofd-bestanden als startpunt en dan uitbreiden.

---

## 6. Data-validatie en schema-checks

### 6.1 Validatie-script

`tools/validate_data.py` (zoals beschreven in 5.1/5.3) voert de volgende stappen uit:

1. JSON Schema-validatie van alle `data/*.json` tegen `schema/*.schema.json`.  
2. Referentie-checks (bestaan `actor_id`, `enemy_id`, `item_id`, `quest_id`, `zone_id`, `event_id` etc. waar ze gebruikt worden?).

Voorbeeld run:

```bash
python -m tools.validate_data
```

### 6.2 Wanneer draaien?

- **Altijd** voordat je een build maakt.  
- Na grotere datawijzigingen (nieuwe quests, nieuwe enemies, nieuwe zones).  
- Als de game crasht op missing IDs of onverwachte data.

---

## 7. Tests draaien (pytest)

### 7.1 Alle tests

Met geactiveerde venv in de projectroot:

```bash
pytest
```

### 7.2 Specifieke tests

Alleen combat-systeem testen:

```bash
pytest tests/test_combat_system.py
```

Of één testcase binnen een bestand:

```bash
pytest tests/test_combat_system.py::test_basic_damage
```

### 7.3 Integratie met run-scripts

Optioneel kunnen `scripts/run_tests.sh` en `scripts/run_tests.ps1` gewoon `pytest` aanroepen (na activatie van de venv).

---

## 8. Formatting & linting

### 8.1 Formatter (black)

Alle Python-code formatteren:

```bash
black src tests tools
```

### 8.2 Linter (ruff)

```bash
ruff check src tests tools
```

### 8.3 Eén script voor beide (optioneel)

`scripts/format.sh`:

```bash
#!/usr/bin/env bash
set -e
source .venv/bin/activate
black src tests tools
ruff check src tests tools
```

`scripts/format.ps1`:

```powershell
. .venv\Scripts\Activate.ps1
black src tests tools
ruff check src tests tools
```

---

## 9. Build / distributie (basis)

In eerste instantie is distributie simpel:

- Je deelt de **broncode + data + assets** en draait de game via `python -m tri_sarira_rpg.app.main`.  
- Een latere stap is een **standalone build** (bijv. met `pyinstaller`).

### 9.1 Simpele distributie (zip)

1. Zorg dat `tools.validate_data` en `pytest` schoon draaien.  
2. Maak een zip van minimaal:

   - `src/`,  
   - `data/`, `schema/`, `maps/`, `assets/`, `config/`,  
   - `pyproject.toml`, `README.md`,  
   - optioneel `scripts/`.

3. Gebruiker:

   - installeert Python + venv,  
   - doet `pip install -e .`,  
   - draait `python -m tri_sarira_rpg.app.main`.

### 9.2 PyInstaller (later)

Wanneer je een standalone executable wilt:

- Maak een `scripts/build_dist.ps1` / `.sh` die:
  1. venv activeert,  
  2. `tools.validate_data` en `pytest` draait,  
  3. `pyinstaller` aanroept met een `.spec`-bestand dat `tri_sarira_rpg.app.main` bundelt.  
- Documenteer welke OS/architectuur je target (voorlopig Windows x64).

Voor v0.1 van de game is dit **optioneel** – focus eerst op stabiele dev-run.

---

## 10. Typical dev-workflow (samenvatting)

Een typische ontwikkelsessie in WSL zou er zo uit kunnen zien:

1. Venv activeren:

   ```bash
   cd ~/projects/tri_sarira_rpg
   source .venv/bin/activate
   ```

2. Laatste changes ophalen:

   ```bash
   git pull
   ```

3. Data valideren (zeker na datawijzigingen):

   ```bash
   python -m tools.validate_data
   ```

4. Game draaien:

   ```bash
   python -m tri_sarira_rpg.app.main
   ```

5. Na wijzigingen in systems: tests draaien:

   ```bash
   pytest
   ```

6. Voor commit: formatter + linter:

   ```bash
   black src tests tools
   ruff check src tests tools
   ```

7. Commit & push:

   ```bash
   git status
   git commit -am "Beschrijf wijziging"
   git push
   ```

---

Deze README is versie 0.1.  
Als tijdens het werken blijkt dat stappen ontbreken of anders lopen (bv. specifieke WSL-issues, asset-paden, extra tools), wordt deze sectie bijgewerkt zodat zowel jij als AI-assistenten altijd een actuele "single source of truth" hebben voor run- & build-instructies.
