# 4.1 JSON-schema’s – Overzicht per type

**Versie:** 0.1  
**Auteur:** Gerald (met Game Designer- & Architect-ondersteuning)  
**Status:** Design-overzicht. Richt de structuur in voor de belangrijkste JSON-schema-bestanden.

Doel: één plek waar is vastgelegd **hoe** de kernschema’s eruit zien, zodat Claude/Codex hier direct `*.schema.json`-bestanden van kan maken.

Minimaal te ondersteunen schema’s:

- `schema/actors.schema.json`  
- `schema/enemies.schema.json`  
- `schema/items.schema.json`  
- `schema/skills.schema.json`  
- `schema/quests.schema.json`  
- `schema/dialogue.schema.json`  
- `schema/npc_schedules.schema.json`  
- `schema/events.schema.json`  
- `schema/savegame.schema.json`

Extra (handig maar optioneel in v1):

- `schema/shops.schema.json`  
- `schema/loot_tables.schema.json`  
- `schema/chests.schema.json`

---

## 1. Algemene conventies

### 1.1 JSON Schema basis

- `"$schema"`: `"https://json-schema.org/draft/2020-12/schema"`  
- `"$id"`: `"schema/<naam>.schema.json"`  
- Waar mogelijk:
  - top-level object met 1 root-property (bv. `actors`, `items`, `quests`).  
  - definities in `"$defs"` voor hergebruik.

### 1.2 ID’s & keys

- Elk belangrijk ding heeft een **string-ID**:
  - `actor_id`, `enemy_id`, `item_id`, `skill_id`, `quest_id`, `dialogue_id`, `npc_id`, `zone_id`, `region_id`, `event_id`, etc.  
- Localised tekst wordt via **keys** gedaan:
  - `name_key`, `description_key`, `line_key`, etc.

### 1.3 Gemeenschappelijke enums (conceptueel)

Niet formeel centraal gedefinieerd, maar **consistent gebruikt**:

- `TriDomain`: `"BODY" | "MIND" | "SPIRIT" | "MIX"`  
- `QuestState`:  
  - `"NOT_DISCOVERED" | "DISCOVERED" | "ACTIVE" | "COMPLETED_SUCCESS" | "COMPLETED_FAIL" | "EXPIRED" | "ABANDONED"`  
- `QuestType`:  
  - `"MSQ" | "CQ" | "RQ" | "TTQ" | "FQ" | "PGQ"`  
- `ZoneType`:  
  - `"TOWN" | "ROUTE" | "WILDERNESS" | "DUNGEON" | "INTERIOR" | "SPECIAL"`  
- `TimeBand`:  
  - bijv. `"MORNING" | "DAY" | "EVENING" | "NIGHT"`  
- `Rarity`:  
  - `"COMMON" | "UNCOMMON" | "RARE" | "EPIC" | "LEGENDARY"`

Balancing kan later enums uitbreiden; schema’s moeten dat toestaan.

---

## 2. `schema/actors.schema.json`

**Doel:** speelbare characters + belangrijke companions (A-tier, sommige S-/B-tier) met hun stats, Tri-profiel, skills en gear.

### 2.1 Root-structuur

- Root-object met property:
  - `actors`: array van Actor.

### 2.2 `Actor` (in `$defs`)

Belangrijkste velden (design):

- Identiteit:
  - `actor_id`: string  
  - `name_key`: string  
  - `description_key`: string (optioneel)

- Rol & tags:
  - `is_playable`: boolean  
  - `is_guest_only`: boolean (tijdelijke party member)  
  - `role_tags`: array van strings (bv. `"BODY_FRONTLINE"`, `"SPIRIT_HEALER"`)

- Tri-profiel:
  - `tri_profile`: object  
    - `phys`: number  
    - `ment`: number  
    - `spir`: number

- Level & progression:
  - `base_level`: integer  
  - `max_level`: integer  
  - `base_body`: integer  
  - `base_mind`: integer  
  - `base_spirit`: integer  
  - `growth_body`: number  
  - `growth_mind`: number  
  - `growth_spirit`: number

- Combatstats (basis):
  - `base_stats`: object met o.a.:  
    - `STR`, `END`, `DEF`, `SPD`, `ACC`, `FOC`, `INS`, `WILL`, `MAG`, `PRA`, `RES`, `DEV` (integers)

- Skills:
  - `starting_skills`: array van `skill_id`s  
  - `learnset`: array van entries:  
    - `skill_id`: string  
    - `learn_at_level`: integer

- Gear:
  - `starting_gear`: object  
    - `weapon_id` (string | null)  
    - `offhand_id` (string | null)  
    - `armor_id` (string | null)  
    - `accessory1_id` (string | null)  
    - `accessory2_id` (string | null)

- Companion/meta (optioneel):
  - `companion_tier`: `"S" | "A" | "B" | "NONE"`  
  - `default_npc_id`: koppeling naar NPC-entry (voor schedules, etc.).

---

## 3. `schema/enemies.schema.json`

**Doel:** vijanden en enemy-groepen voor gevechten.

### 3.1 Root

- `enemies`: array van Enemy.

### 3.2 `Enemy`

- Identiteit:
  - `enemy_id`: string  
  - `name_key`: string  
  - `description_key`: string (optioneel)

- Tri & rol:
  - `tri_focus`: `TriDomain`  
  - `role_tags`: array van strings (bijv. `"PHYSICAL_BRUTE"`, `"SPIRIT_CASTER"`)

- Level & stats:
  - `level`: integer (of level_range)  
  - `base_stats`: zelfde structuur als bij Actor

- Skills:
  - `skills`: array van `skill_id`s (AI beslist gebruik)  
  - optioneel `ai_profile_id`: string

- Loot & XP:
  - `xp_reward`: integer  
  - `loot_table_id`: string  
  - optioneel `money_min`, `money_max`: integers

- Flags:
  - `is_boss`: boolean  
  - `is_unique`: boolean

---

## 4. `schema/items.schema.json`

**Doel:** alle items (consumables, gear, materials, quest/key items).

### 4.1 Root

- `items`: array van Item.

### 4.2 `Item`

- Identiteit:
  - `item_id`: string  
  - `name_key`: string  
  - `description_key`: string

- Type & subtypes:
  - `item_type`:  
    - `"CONSUMABLE" | "GEAR" | "MATERIAL" | "QUEST" | "KEY"`  
  - `gear_type`: indien GEAR  
    - `"WEAPON" | "ARMOR" | "SHIELD" | "ACCESSORY" | null`  
  - `slot`: indien GEAR  
    - `"WEAPON" | "OFFHAND" | "BODY" | "ACCESSORY1" | "ACCESSORY2" | null`

- Tri & rarity:
  - `tri_focus_primary`: `TriDomain`  
  - `tri_focus_secondary`: `TriDomain` (optioneel)  
  - `rarity`: `Rarity`

- Stats/effect:
  - `stat_mods`: object (string -> number) voor gear  
  - `consumable_effect_id`: string (koppeling naar effect-logica)  
  - `flags`: array van strings (bv. `"NO_SELL"`, `"UNIQUE"`)

- Stack & economie:
  - `max_stack`: integer  
  - `buy_price`: integer  
  - `sell_price`: integer (optioneel)

- Restricties:
  - `allowed_actor_tags`: array van strings (bepaalde classes/rollen)  
  - `required_tri_focus`: optioneel Tri-constraint.

---

## 5. `schema/skills.schema.json`

**Doel:** skills die in combat (en soms overworld) gebruikt worden.

### 5.1 Root

- `skills`: array van Skill.

### 5.2 `Skill`

- Identiteit:
  - `skill_id`: string  
  - `name_key`: string  
  - `description_key`: string

- Type & Tri:
  - `skill_type`:  
    - `"BODY" | "MIND" | "SPIRIT" | "HYBRID" | "PASSIVE"`  
  - `tri_focus`: `TriDomain` (optioneel, als extra label)

- Cost & cooldown:
  - `stamina_cost`: integer  
  - `focus_cost`: integer  
  - `prana_cost`: integer  
  - `cooldown_turns`: integer (optioneel)

- Targeting:
  - `target_type`:  
    - bijv. `"SELF" | "ALLY_SINGLE" | "ALLY_ALL" | "ENEMY_SINGLE" | "ENEMY_ROW" | "ENEMY_ALL"`  
  - `range_type`: (indien grid-combat later relevant)

- Effecten:
  - `power`: number (basis-damage/heal-schaal)  
  - `element_tags`: array van strings (optioneel)  
  - `effect_ids`: array van IDs die naar generieke effect-blokken verwijzen.

- Unlock-condities (design):
  - `learn_conditions`: object  
    - `min_level`: integer (optioneel)  
    - `required_quest_ids`: array  
    - `min_body`, `min_mind`, `min_spirit`: integers (optioneel)  
    - `required_item_ids`: array (optioneel)

---

## 6. `schema/quests.schema.json`

**Doel:** alle quests, inclusief stages, objectives en rewards.

### 6.1 Root

- `quests`: array van Quest.

### 6.2 `Quest`

- Identiteit:
  - `quest_id`: string  
  - `title_key`: string  
  - `summary_key`: string

- Type & context:
  - `quest_type`: `QuestType`  
  - `region_id`: string  
  - `tri_focus_primary`: `TriDomain`  
  - `tri_focus_secondary`: `TriDomain` (optioneel)  
  - `giver_npc_id`: string (optioneel)

- Start-condities:
  - `required_flags`: array van `flag_id`s  
  - `forbidden_flags`: array  
  - `time_window`: object (optioneel)  
    - `season_index`, `day_index_range`, `festival_id`

- Stages:
  - `stages`: array van Stage

- Rewards:
  - `rewards`: object  
    - `xp`: integer  
    - `money`: integer  
    - `item_rewards`: array van `{ item_id, quantity }`  
    - `flag_rewards`: array van flag_id’s

### 6.3 `Stage`

- `stage_id`: string  
- `description_key`: string  
- `objectives`: array van Objective  
- `auto_advance`: boolean  
- `next_on_success`: string (stage_id of speciale value)  
- `next_on_fail`: string (optioneel)  
- `enter_effect_ids`: array (optioneel)  
- `complete_effect_ids`: array (optioneel)

### 6.4 `Objective`

- `objective_type`:  
  - `"TALK_TO_NPC" | "REACH_ZONE" | "DEFEAT_ENEMY_GROUP" | "COLLECT_ITEM" | "WAIT_UNTIL_TIME" | "CUSTOM_FLAG"`  
- `target_npc_id`, `target_zone_id`, `enemy_group_id`, `item_id`: afhankelijk van type  
- `quantity`: integer (optioneel)  
- `custom_flag_id`: string (optioneel)

---

## 7. `schema/dialogue.schema.json`

**Doel:** dialooggraphs voor NPC’s, scenes, quests.

### 7.1 Root

Twee opties; v1 kiezen we:

- `dialogues`: array van DialogueGraph.

### 7.2 `DialogueGraph`

- `dialogue_id`: string  
- `scope`: string (bijv. `"NPC"`, `"SCENE"`, `"QUEST"`)  
- `owner_id`: string (npc_id, quest_id, scene_id)  
- `nodes`: array van DialogueNode

### 7.3 `DialogueNode`

- `node_id`: string  
- `speaker_id`: string (`npc_id` of `"PLAYER"`)  
- `lines`: array van Line  
- `choices`: array van Choice (optioneel)  
- `auto_advance_to`: string (node_id, optioneel)  
- `conditions`: array van Condition (optioneel)  
- `once_per_save`: boolean (optioneel)  
- `once_per_day`: boolean (optioneel)

### 7.4 `Line`

- `text_key`: string  
- `emotion`: string (optioneel)  
- `voice_tag`: string (optioneel, voor audio later)

### 7.5 `Choice`

- `choice_id`: string  
- `text_key`: string  
- `conditions`: array van Condition (optioneel)  
- `effects`: array van EffectRef  
- `next_node_id`: string (optioneel)  
- `end_conversation`: boolean (optioneel)

### 7.6 `Condition` & `EffectRef`

Generiek condition-model (discriminated union):

- `Condition`:
  - `type`:  
    - `"FLAG" | "QUEST_STATE" | "QUEST_STAGE" | "TIME" | "ZONE" | "COMPANION" | "STAT" | "KARMA"`  
  - `flag_id`, `quest_id`, `zone_id`, `npc_id`, `stat_name`, etc. afhankelijk van type  
  - `operator`: `"EQ" | "NE" | "GT" | "GTE" | "LT" | "LTE"` (bij numeric)

- `EffectRef`:
  - `effect_type`:  
    - `"SET_FLAG" | "CLEAR_FLAG" | "QUEST_START" | "QUEST_ADVANCE" | "QUEST_COMPLETE_SUCCESS" | "QUEST_COMPLETE_FAIL" | "GIVE_ITEM" | "ADD_COMPANION" | "REMOVE_COMPANION" | "SET_NPC_PHASE" | "WORLD_CHANGE" | "MODIFY_STAT" | ...`  
  - bijbehorende velden (`flag_id`, `quest_id`, `stage_id`, `item_id`, `npc_id`, etc.).

---

## 8. `schema/npc_schedules.schema.json`

**Doel:** schedules voor NPC-positie en gedrag door dag/nacht, seizoenen en festivals.

### 8.1 Root

- `npc_schedules`: array van NpcSchedule.

### 8.2 `NpcSchedule`

- `npc_id`: string  
- `rules`: array van ScheduleRule

### 8.3 `ScheduleRule`

- `day_type`: string  
  - bijv. `"ANY" | "WEEKDAY" | "WEEKEND" | "FESTIVAL"` (meer types mogelijk)  
- `season_index`: integer (optioneel, -1 of null = alle seizoenen)  
- `festival_id`: string (optioneel)  
- `time_band`: `TimeBand`  
- `zone_id`: string  
- `tile_x`: integer  
- `tile_y`: integer  
- `facing`: string (optioneel; bijv. `"N" | "E" | "S" | "W"`)  
- `behavior_id`: string (optioneel; verwijst naar gedragspatroon zoals patrol, idle, wander)

Runtime kan per tick/overworld-step de relevante rule selecteren op basis van TimeState.

---

## 9. `schema/events.schema.json`

**Doel:** generieke events/cutscenes/wereldscripts die Scenes & State Flow aanroepen.

### 9.1 Root

- `events`: array van Event.

### 9.2 `Event`

- `event_id`: string  
- `name_key`: string  
- `trigger`: Trigger  
- `conditions`: array van Condition (zie 7.6)  
- `actions`: array van Action

### 9.3 `Trigger`

- `type`:  
  - `"ON_ENTER_ZONE" | "ON_INTERACT_OBJECT" | "ON_QUEST_STAGE_REACHED" | "ON_TIME_REACHED" | "MANUAL"`  
- `zone_id`, `object_id`, `quest_id`, `stage_id`, `day_index`, `time_band` etc. afhankelijk van type.

### 9.4 `Action`

- `action_type`:  
  - bijv. `"PLAY_CUTSCENE" | "TELEPORT" | "SET_TIME" | "START_BATTLE" | "RUN_DIALOGUE" | "APPLY_EFFECTS"`  
- parameters afhankelijk van `action_type`:
  - `cutscene_id`, `target_zone_id`, `target_tile_x/y`, `enemy_group_id`, `dialogue_id`, `effect_ids`, etc.

Events vormen de schakel tussen data (quests, dialogue, etc.) en Scenes.

---

## 10. `schema/savegame.schema.json`

**Doel:** structuur van SaveData (zie 3.8 Save & Trilogy Continuity Spec).

### 10.1 Root

- Root-object `SaveData` met properties:
  - `meta`, `time_state`, `world_state`, `player_state`, `party_state`,  
    `actors_state`, `npc_state`, `quests_state`, `flags_state`,  
    `inventory_state`, `economy_state`, `postgame_state`, `ngplus_state`.

### 10.2 Kern-substructuren (samengevat)

- `meta`:  
  - `schema_version`, `build_id`, `slot_id`, `profile_id`, `created_at`, `updated_at`,  
    `play_time`, `chapter_id`, `main_story_state`, `is_postgame`, `is_ngplus`,  
    `ngplus_cycle`, `clear_count`, `trilogy_profile_id`.

- `time_state`:  
  - `day_index`, `time_of_day`, `season_index`, `year_index` (optioneel).

- `world_state`:  
  - `current_zone_id`, `player_position` (`x`, `y`),  
  - `unlocked_regions`, `discovered_zones`, `fast_travel_points_unlocked`,  
  - `environment_flags`, `active_events`.

- `party_state`:  
  - `active_party`, `reserve_pool`, `guest_party`,  
  - `circle_state` (unlocked, locations, upgrades).

- `actors_state`:  
  - map of `actor_id -> ActorSaveState` (level, xp, stats, Tri-scores, skills, gear, relatie-flags).

- `npc_state`:  
  - map of `npc_id -> NpcSaveState` (phase, recruited, settlement, current_zone_id optioneel, services).

- `quests_state`:  
  - map of `quest_id -> QuestSaveState` (state, current_stage_id, stage_progress_data, quest-specific flags).

- `flags_state`:  
  - `story_flags` (set/list), `choice_history`, `karma_state`, `tutorial_flags`.

- `inventory_state`:  
  - `items` (item_id + quantity), `key_items`, `quest_items`,  
  - `chests_opened`, `special_collections` (shrines, lore stones, viewpoints).

- `economy_state`:  
  - `currency_amount`, `shop_states` (per shop: inventory_overrides, last_refresh_day_index, shop_flags).

- `postgame_state`:  
  - `postgame_unlocked`, `tri_high_trials_completed`, `superbosses_defeated`,  
  - `pg_companion_epilogues_seen`, `festivals_completed`, `collectables_completion`.

- `ngplus_state`:  
  - `ngplus_cycle`, `ngplus_origin_slot`, `ngplus_carry_over`, `ngplus_modifiers`.

Dit schema is het meest complex; implementatie kan gefaseerd gebeuren (eerst subset voor vertical slice).

---

## 11. Extra schema’s (shops, loot, chests)

### 11.1 `schema/shops.schema.json`

- Root: `shops`: array van Shop.  
- `Shop`:  
  - `shop_id`, `zone_id`, `name_key`, `shop_type`,  
  - `inventory_entries`: array `{ item_id, base_price, stock_type, min_chapter, max_chapter, conditions[] }`.

### 11.2 `schema/loot_tables.schema.json`

- Root: `loot_tables`: array van LootTable.  
- `LootTable`:  
  - `loot_table_id`, `entries`: array  
    - `item_id` (of `is_money` + amount), `drop_chance`, `quantity_min`, `quantity_max`, `rarity_tag`.

### 11.3 `schema/chests.schema.json`

- Root: `chests`: array van Chest.  
- `Chest`:  
  - `chest_id`, `zone_id`, `contents`: array van `{ item_id, quantity, weight? }`,  
  - `one_time_only` (bool), `conditions` (optioneel).

---

## 12. Relatie met andere artefacten

- Alle **3.x Systems Specs** geven de conceptuele inhoud waar deze schema’s data voor gaan dragen.  
- **3.8 Save & Trilogy Continuity Spec** levert de SaveData-structuur die hier vertaald is naar `savegame.schema.json`.  
- **2.x World & Narrative** bepalen voornamelijk IDs (`region_id`, `zone_id`, `npc_id`, `quest_id`, etc.) en worden in deze schema’s gerefereerd.

Versie 0.1 geeft een **concreet raamwerk**. Claude/Codex kan dit direct omzetten naar echte JSON Schema-bestanden (`*.schema.json`) en daarna gradual uitbreiden (meer enums, constraints, description-fields) zonder het basismodel te breken.

