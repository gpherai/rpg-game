# 3.3 NPC & Party System Spec – Tri-Śarīra RPG

**Versie:** 0.1  
**Auteur:** Gerald (met Game Designer- & Architect-ondersteuning)  
**Status:** Design-spec. Richt de regels in voor companions, party, Circle of Companions en missables.

---

## 1. Doel & scope

Dit document beschrijft **hoe NPC’s als companions functioneren** en hoe de **party** werkt, zowel in overworld als in combat.

Focus:

- Hoe companions worden **gerekruteerd, tijdelijk vertrekken en zich vestigen** (koppeling met 2.3 NPC Cast & Fasen).  
- Hoe de **party** is opgebouwd: actieve leden, reserves, zichtbaarheid in overworld.  
- Hoe de **Circle of Companions** als systeem en hub werkt.  
- Welke **missables-regels** gelden voor companions en NPC-fasen.

Het document haakt in op:

- **2.3 NPC Cast & Fasen** – fasen Ontmoeting → Metgezel → Vestiging → Epiloog.  
- **2.1 World & Regions Overview** – waar companions vandaan komen en waar ze settelen.  
- **2.2 Kalender & Festivals Spec** – wanneer companions beschikbaar zijn.  
- **2.4 Quest Taxonomy & Voorbeeldlijst** – companion quests, trials.  
- **3.1 Combat & Stats Spec** – hoe partyleden in combat functioneren.  
- **3.2 Time, World & Overworld Spec** – hoe party zich door de wereld beweegt.  
- **4.x Data & Schema’s** – vooral `actors.json`, `npc_schedules.json`, `savegame.json`.

---

## 2. Designprincipes

1. **NPC’s hebben een eigen leven**  
   Companions zijn geen “inventaris-items”; ze hebben eigen arcs, verplichtingen en momenten waarop ze weg zijn of zich vestigen.

2. **Keuze & consequentie**  
   Je kunt niet iedereen altijd hebben. Keuzes in quests en hoofdverhaal beïnvloeden wie bij je is en wie zich waar vestigt.

3. **Leesbare systemen**  
   Het moet duidelijk zijn *waarom* iemand met je mee kan (of niet), en waar je ze kunt vinden.

4. **Speler niet softlocken op systeem-niveau**  
   De main story moet altijd voltooid kunnen worden met de companions die nog beschikbaar zijn, ook als je sommige arcs “fout” of niet afrondt.

5. **Trilogie-bewust**  
   De status van companions (levend, pad-keuze, vestiging, relatie) wordt in de save vastgelegd voor gebruik in deel 2/3.

---

## 3. NPC-lagen & companion-geschiktheid

Herhaling uit 2.3, toegepast op party-systeem:

- **S-tier – Story-pilaren**  
  - Impact op main story en trilogie, maar niet allemaal als permanente companions.  
  - Kunnen tijdelijk meevechten (bijv. mentoren), maar niet altijd kiesbaar.

- **A-tier – Core companions**  
  - Kunnen langdurig deel uitmaken van je party.  
  - Hebben companion quests, vestiging en epiloges.

- **B-tier – Regionale kern-NPC’s**  
  - Meestal geen permanente companions, maar kunnen tijdelijk aansluiten als guest-party-members.  
  - Of worden dienstenaanbieders in hubs (trainers, shopkeepers, ritualisten).

- **C/D-tier**  
  - Geen party-members; achtergrond, functies, ambience.

**Party-systeem focust primair op A-tier;** S- en B-tier kunnen speciale uitzonderingen hebben (tijdelijke guest slots).

---

## 4. Party-model

### 4.1 Party-samenstelling

Basismodel voor de volledige game:

- `party_max_size` (in combat): **4 units** (1 protagonist + max. 3 companions).  
- `active_party` – de groep die zowel in overworld als in combat actief is.  
- `reserve_pool` – alle companions die gerekruteerd zijn maar niet in de active party zitten.

De protagonist is **verplicht** onderdeel van de active party, tenzij uitzonderlijke story-secties dit anders vereisen (bepaalde inner journeys).

Vertical slice (M2):

- Start met **1 unit** (protagonist).  
- Later in slice eventueel **2e unit** om basisswitching te testen.

### 4.2 Zichtbare party in overworld

**Designkeuze v1:**

- In de overworld is **alleen de leader zichtbaar** (standaard protagonist).  
- De rest van de party is impliciet aanwezig (JRPG-stijl).  
- Dit houdt movement simpel en voorkomt drukke sprites in smalle maps.

Toekomstoptie (niet verplicht):

- Later kunnen we optioneel een **“follow chain”** implementeren (2–3 zichtbare volgers), maar alleen als dat goed werkt met collision/tiles.

### 4.3 Party & scenes

- **OverworldScene:** gebruikt enkel de active_party voor context (dialogue-varianten op basis van wie erbij is).  
- **BattleScene:** laadt stats/skills van active_party.  
- **MenuScene:** laat party, equipment, skills en formatie zien.

---

## 5. Companion lifecycle & party

We koppelen de fasen van 2.3 direct aan partylogica.

### 5.1 Fase 1 – Ontmoeting

- NPC is **niet** recruitable; ze hebben hun eigen agenda.  
- Mechanisch:
  - `is_known = true`  
  - `is_recruitable = false`  
  - dialoog en intro-quest beschikbaar.

### 5.2 Fase 2 – Metgezel / Reisgenoot

- NPC kan de party **tijdelijk** joinen:
  - als **volwaardige companion** (A-tier),  
  - of als **guest** (B-/S-tier) met beperkte bediening (geen equip/skills veranderen).

- Mechanisch:
  - `is_recruitable = true` (voor A-tier)  
  - `in_party = true/false`  
  - `is_guest = true/false` (flag voor controlebeperkingen).

- De speler kan bij de meeste A-tier companions vanuit de Circle of Companions/hubs bepalen of ze **actief** zijn of in de reserve_pool.

### 5.3 Fase 3 – Vestiging

- Companion heeft een belangrijke arc afgerond en kiest een **plek in de wereld**:
  - als leraar, shopkeeper, bewaker, priester, etc.  
- Ze laten de party mogelijk **permanent of semi-permanent** achter.

- Mechanisch:
  - `npc_phase = "SETTLED"`  
  - `settlement_location_id` (hub/zone).  
  - `in_party = false` (tenzij uitzonderlijk).  
  - `offers_service = [ ... ]` (shop, training, ritueel, etc.).

### 5.4 Fase 4 – Opnieuw oproepbaar / Epiloog

- Companion is gevestigd maar kan via de **Circle of Companions** of een specifieke locatie **weer meereizen**, vooral in late-game/post-game.  
- In sommige cases slechts tijdelijk (speciale quests, trials).

- Mechanisch:
  - `npc_recruitable_post_arc = true`  
  - `in_circle_pool = true`  
  - `in_party` wordt weer togglebaar.

Niet elke companion doorloopt alle fasen; sommige zijn harde “settlers” (blijven op hun plek).

---

## 6. Recruitment & dismissal-regels

### 6.1 Recruitment

Een NPC kan companion worden wanneer:

- Story & quest-codities voldaan zijn (intro-quest, vertrouwen, vlaggen).  
- Eventuele Tri-/level-vereisten gehaald zijn (optioneel: b.v. bepaalde Body/Mind/Spirit-checks).

Mechanisch:

- Quest-event of dialoogoptie triggert `add_to_reserve_pool(npc_id)` en optioneel direct `add_to_active_party(npc_id)` als er plek is.

### 6.2 Dismissal (tijdelijk)

- De speler kan bij de Circle of Companions of soms in hubs companions **uit de active party halen**:
  - `move_to_reserve_pool(npc_id)`.

- In het veld (overworld), buiten Circle/hubs, is dismissal beperkt:  
  - In v1 alleen via story-events (NPC vertrekt door eigen agenda).  
  - Eventueel later: eenvoudige “swap party” vanaf een camp-systeem.

### 6.3 Forced leave / story-gedreven veranderingen

- Story kan forceren dat companions tijdelijk vertrekken of onbeschikbaar zijn:  
  - `npc_forced_unavailable = true` met reason-tag.  
  - Dit voorkomt dat de speler alle arcs tegelijk kan stapelen.

### 6.4 Death & KO

Tri-Śarīra en verhaalbalans:  

- In basis-game: **geen permadeath** voor core companions (A-tier) bij normale gevechten.  
- Permadeath/irreversible outcomes uitsluitend via **grote quests/choices**, niet via willekeurig gevecht.

Mechanisch:

- KO in battle → unit wordt na gevecht weer wakker met lage HP, mogelijke penalty (resourceverlies, status).  
- Speciale story-battles kunnen flags zetten die de status permanent veranderen (bv. wounded, path-change, dood).

---

## 7. Circle of Companions

### 7.1 Concept

De **Circle of Companions** is een narratief en systeemmatig **ankerpunt** waar je:

- companions kunt ontmoeten/spreken buiten het veld.  
- party-samenstelling kunt aanpassen.  
- sommige trainings-, rituele of epiloog-acties kunt uitvoeren.

In wereldtermen:

- Kan starten als een kleine plek (huis, schuur, tempelkamer) in R1 Chandrapur.  
- Groeit naarmate je meer companions, regio’s en hoofdstukken bereikt.

### 7.2 Functionaliteit (systeem)

1. **Party management**  
   - Bekijk alle companions in `reserve_pool` + `active_party`.  
   - Swap companions (binnen `party_max_size`).  
   - Bekijk basisinfo (Tri-profiel, level, rol).

2. **Companion-dialogen / slice-episodes**  
   - Kleine scenes, reflecties na quests of hoofdverhaal-events.  
   - Hook voor companion-quests & epilogen.

3. **Training & rituelen** (later)  
   - Limit break, Tri-specifieke rituelen, synergy-skills.

4. **Post-game hub**  
   - Veel companions keren hier terug; functioneert als uitvalsbasis voor Trials, ultra-bosses, DLC-achtige NPC-episodes.

### 7.3 Ontgrendeling

- In Chapter 1 fungeert een **simpel huis/ruimte in Chandrapur** als eerste Circle-plek.  
- In latere hoofdstukken/regio’s kunnen **sub-hubs** fungeren als lokale Circles (bijv. in stad of klooster), allemaal gekoppeld aan hetzelfde systeem.

---

## 8. Missables & companion-regels

### 8.1 Filosofie

- **Ja, companions en arcs kunnen missable zijn.**  
- Niet alle companions hoeven in één run gerekruteerd of “voltooid” te worden.  
- De main story blijft speelbaar, ongeacht welke companions je hebt.

### 8.2 Typen missables

1. **Recruitment missable**  
   - Je ontmoet iemand niet (of te laat) → nooit in party.  
   - Of je kiest expliciet tegen een recruitment-keuze.

2. **Arc-uitkomst missable**  
   - Je speelt wel hun arc, maar maakt keuzes die hun toekomst beperken.  
   - Bv. jeugdvriend(in) blijft dorpsbeschermer en is daarna beperkt recruitable.

3. **Post-game re-recruit missable**  
   - Sommige companions kunnen in post-game terugkeren; als je bepaalde Trials niet doet, mis je extra content.

### 8.3 Grenzen aan missables

- Minimaal 1–2 **Body/Mind/Spirit-vertegenwoordigers** moeten *altijd* beschikbaar zijn in elke grotere storyfase.  
- Geen situatie waarin de speler alle healers verliest zonder alternatief (game design safeguard).

### 8.4 Save & trilogie

- Companion-status wordt uitgebreid gelogd:
  - `recruited`, `phase`, `settled_location`, `survived_key_events`, `epilogue_state`.  
- Deel 2 kan deze flags gebruiken om:
  - voorouder-quests of vereringsvormen aan te passen,  
  - cameo’s/impact van vorige generaties te tonen.

---

## 9. Data & schema-koppeling

Belangrijke data-bronnen:

- **`actors.json`** – stats & Tri-profiel per NPC/companion.  
- **`npc_meta.json`** – tier, fasen, home_region, companion-compatibiliteit.  
- **`npc_schedules.json`** – waar NPC zich bevindt per tijd, dagtype, seizoen, festival.  
- **`quests.json`** – welke quests NPC-fase-transities triggeren (Ontmoeting → Metgezel → Vestiging).  
- **`savegame.json`** – companionstatus, party samenstelling, Circle-state.

Conceptuele velden per companion (voorbeeld):

- `npc_id`  
- `tier`  
- `is_companion_candidate` (bool)  
- `companion_flags`:  
  - `recruited`  
  - `in_party`  
  - `in_reserve_pool`  
  - `phase` (SEED/COMPANION/SETTLED/EPILOGUE)  
  - `settlement_location_id`  
  - `postgame_recruitable`  
  - `guest_only` (bij B/S-tier).  

De exacte schema’s en opslag worden verder uitgewerkt in 4.x.

---

## 10. Vertical Slice vs. volledige game

### 10.1 Vertical Slice (M2)

Voor de slice is nodig:

- Minstens **1 companion** in R1 (jeugdvriend(in) of vergelijkbare rol).  
- Simpel systeem:  
  - quest → companion joint tijdelijk de party,  
  - max party size 2,  
  - eenvoudige join/leave-event via quest of korte dialoog.  
- Geen volledige Circle-hub nodig; een heel basale UI voor party-overzicht is genoeg.

### 10.2 Latere milestones

- **M3 – Chapter 1:**  
  - Circle of Companions v0 in Chandrapur.  
  - 2–3 companions, simpele reserve_pool en party-swap in hub.

- **M4–M5:**  
  - Volledig party-systeem met 4 slots.  
  - Meerdere regionale companions en missables.  
  - Circle-hubs in andere regio’s.

- **M6 (Trilogy Hooks):**  
  - Save & trilogy continuity spec koppelt companionstatus aan exportformaat.

---

## 11. Relatie met andere artefacten

- **2.3 NPC Cast & Fasen** – definieert wie companions zijn en welke fasen zij doorlopen; dit document vertaalt dat naar systeemregels.  
- **2.1 World & Regions Overview** – bepaalt in welke regio’s companions wonen en waar ze zich vestigen.  
- **2.2 Kalender & Festivals Spec** – beïnvloedt beschikbaarheid (tijdgebonden appearances).  
- **2.4 Quest Taxonomy & Voorbeeldlijst** – levert companion quests en missable arc-uitkomsten.  
- **3.1 Combat & Stats Spec** – bepaalt hoe companions zich in combat gedragen.  
- **3.2 Time, World & Overworld Spec** – regelt movement en scenes waar de party zich bevindt.  
- **4.x Data & Schema’s** – implementeren de JSON-structuren en savegame-lagen voor companions en party.

Versie 0.1 zet de **regels en grenzen** van het NPC & Party System neer. Verdere tuning (precies aantal companions, exacte missables) komt met narrative en balancing, maar het raamwerk staat vast.

