# 3.2 Time, World & Overworld Spec – Tri-Śarīra RPG

**Versie:** 0.1  
**Auteur:** Gerald (met Game Designer- & Architect-ondersteuning)  
**Status:** Design-spec. Richt de *overworldlaag* in: zones, portals, encounters en de koppeling met dag/nacht/seizoenen.

---

## 1. Doel & scope

Dit document beschrijft hoe de **wereldlaag** werkt vanuit gameplay-perspectief:

- Hoe de wereld is opgedeeld in **regio’s, zones en maps**.  
- Hoe de speler zich door de wereld beweegt (overworld movement, portals, travel).  
- Hoe **tijd** (dag/nacht + seizoenen, zie 2.2) in de overworld wordt gebruikt.  
- Hoe **encounters** en events getriggerd worden in de overworld.

Het is een **designlaag**, engine-onafhankelijk maar afgestemd op:

- Python + Pygame runtime.  
- **Tiled** als map-editor.  
- JSON als bron voor zone-, encounter- en eventdata.

Deze spec bouwt op:

- **1.2 Core Baseline** – Tri-Śarīra, wereldgevoel, QoL.  
- **1.3 Feature Roadmap** – M1/M2/M3 doelen voor wereld & overworld.  
- **2.1 World & Regions Overview** – macrostructuur (R1–R8).  
- **2.2 Kalender & Festivals Spec** – tijdmodel & events.  
- **Scenes & State Flow** + **Systems Overview – Global Systems** – globale scene-architectuur.

---

## 2. Wereldstructuur – regio → zone → map

### 2.1 Begrippen

- **Regio (Region)** – grote thematische gebieden (R1 Chandrapur, R2 Vanagiri, etc.).  
- **Zone** – concrete spelgebieden binnen een regio (dorp, route, bos, dungeon-floor, interieur).  
- **Map** – de daadwerkelijke Tiled-map (één zone = één map in v1).

Later kunnen we per zone meerdere varianten hebben (bijv. seizoensvarianten, instanced dungeons); v1 gaat uit van **1 map per zone**.

### 2.2 Zone-typen

Belangrijke `zone_type`-categorieën:

- `TOWN` – dorpen, steden, hubs.  
- `ROUTE` – verbindende paden, velden, wegen.  
- `WILDERNESS` – bossen, bergen, woestijnen, moerassen.  
- `DUNGEON` – kerkers, ruïnes, inner realms, tempelinterieurs.  
- `INTERIOR` – huizen, winkels, kleine gebouwen.  
- `SPECIAL` – astrale gebieden, trial-arena’s, unieke instanced maps.

**TOWN** en sommige **INTERIORS** zijn meestal **safe zones** (geen random encounters). Andere zone-types kunnen encounter-tables hebben.

### 2.3 Zone-metadata (conceptueel)

Voor elke zone definiëren we in JSON minstens:

- `zone_id` – unieke key.  
- `region_id` – referentie naar wereldregio (R1–R8).  
- `name` – naam voor UI.  
- `zone_type` – TOWN/ROUTE/WILDERNESS/DUNGEON/INTERIOR/SPECIAL.  
- `level_range` – indicatieve level-range (min/max).  
- `encounter_table_id` – welke encounterset hoort bij deze zone (of `null`).  
- `music_profile_id` – welk muziek/ambient-profiel.  
- `time_profile_id` – optioneel: hoe sterk tijd visueel/audio wordt getoond.  
- `safe_zone` – bool (true = geen random encounters).  
- `fast_travel_point` – bool (true = kan als fast travel-doel gebruikt worden).  
- `tiled_map` – pad of referentie naar Tiled-export.

Dit wordt verder uitgewerkt in `zones.schema.json`.

---

## 3. Overworld movement & camera

### 3.1 Movementmodel (v1)

- **Tile-based movement** (grid-aligned), met smooth sliding.  
- Speler beweegt in stappen over walkable tiles; collision-layer bepaalt blokkades.

**Richting**: 4-dir movement (N/O/Z/W) is voldoende voor v1. 8-dir kan later.

Bewegingssnelheid:

- Richting: ~0,15–0,20s per tile (tuning op gevoel).  
- Sprint (later) verbruikt extra Stamina maar verhoogt snelheid.

### 3.2 Camera

- Camera volgt de speler centraal met kleine margins.  
- In kleine maps kan camera locken (geen scroll), in grotere maps scrollt hij mee.

### 3.3 Interactie

- **Interact-knop** bij NPC’s, borden, objecten, deuren, portals.  
- Interactie-radius: 1 tile voor de speler (voor je).  
- **Context-hints** (QoL): klein icoon of subtiele animatie als de speler naast een interactable staat.

---

## 4. Portals & overgang tussen zones

### 4.1 Portaltypes

- **Zone↔Zone-portals** – route ↔ dorp, route ↔ route, etc.  
- **Exterior↔Interior-portals** – huisdeuren, winkeldeuren, tempelingangen.  
- **Floor↔Floor-portals** – trappen, liften in dungeons.  
- **Special-portals** – naar astrale maps, trial-arena’s, cutscene-instanties.

### 4.2 Portal-metadata (conceptueel)

Per portal (in JSON of Tiled properties):

- `portal_id`  
- `from_zone_id`, `to_zone_id`  
- `from_spawn_region` (rechtstreeks uit Tiled shape)  
- `to_spawn_point_id` (named spawn in target map)  
- `conditions`: lijst van vereisten
  - storyflag(s)  
  - time_band (DAWN/DAY/DUSK/NIGHT)  
  - season_index  
  - karma/dharma-vereisten (later)  
- `transition_type`: fade, cut, speciale animatie.  
- `plays_cutscene_id`: optioneel cutscene bij eerste gebruik.

### 4.3 Tiled-conventies

In Tiled definiëren we o.a.:

- Een `portals`-objectlaag met **rects** of **polygons**.  
- Custom properties:
  - `portal_id`, `to_zone_id`, `to_spawn_point_id`.  
  - Optioneel `condition_flag`, `time_band`, `season`, etc.
- Een `spawns`-objectlaag in de target-map met named spawn points.

De engine leest Tiled-export → bouwt interne `Portal`-objecten.

---

## 5. Tijd in de overworld

De **TimeState** uit 2.2 wordt in de overworld als volgt gebruikt:

### 5.1 TimeState recap

TimeState bevat minimaal:

- `day_index` – aantal dagen sinds game-start.  
- `time_of_day` – b.v. minuten sinds middernacht (0–1439).  
- `season_index` – 0–3 (Vasanta/Grīṣma/Śarada/Hemanta).  
- Optioneel `year_index`.

### 5.2 Tijd-updates

In de overworld:

- **Elke movement-tick** verhoogt `time_of_day` met een klein aantal minuten.  
- Na `time_of_day >= 1440` → `day_index++`, `time_of_day -= 1440`.  
- Seizoensverloop wordt door `day_index` bepaald (zie 2.2).

In andere scenes:

- **CombatScene:** v1 → tijd **stopt** (geen dag-/nachtverloop tijdens gevecht).  
- **MenuScene:** tijd stopt (pauze).  
- **Cutscenes:** tijd kan stoppen of gemanaged worden per event (b.v. timeskip na grote story-event).

### 5.3 Dag/nacht in de overworld

Overworld gebruikt `time_band` uit 2.2 (DAWN/DAY/DUSK/NIGHT) voor:

- Licht/tint (kleur-overlay per band).  
- Ambient-geluid/muziek.  
- Welke NPC-schedules actief zijn.  
- Welke encounter-tables gelden.

Per **zone** kan het effect afzwakken (bv. INTERIOR minder lichtverschil; TOWN met fakkels ’s nachts).

### 5.4 Seizoenen in de overworld

Seizoenen beïnvloeden per zone:

- Tilevarianten (later): andere decorlaag (bloesem, sneeuw, droog gras).  
- Ambient (geluid van regen, wind).  
- Encounter-samenstelling (andere fauna/spirits).  
- Welke festivals/events (FQ’s) actief zijn.

In v1 (vertical slice): seizoens-effecten zijn **hard-coded** (bijv. altijd lente) of minimaal.

---

## 6. Encounters in de overworld

### 6.1 Encountermodellen

We ondersteunen minimaal twee modellen (niet allebei verplicht in slice):

1. **Random step-based encounters** – klassiek JRPG-model.  
2. **Visible field enemies** – vijanden lopen rond op map; gevecht start bij contact.

Voor de **vertical slice** volstaat één model (bv. random in gras/veld). Later kunnen we mixen.

### 6.2 Random encounters – basismodel

Per `zone_id` koppelen we een `encounter_table_id`.  
Elke stap op een tile die `encounter_enabled = true` heeft, verhoogt een interne teller.

Conceptueel:

- `step_counter += 1` bij elke stap.  
- Kans op encounter stijgt met steps: `Chance = base_chance + step_counter * step_factor`.  
- Bij encounter → `step_counter = 0`.

`base_chance`, `step_factor` kunnen per zone verschillen (route vs safe-forest vs heavy-dungeon).

Tegelijk houden we rekening met:

- `time_band` – andere tables voor DAY vs NIGHT.  
- `season_index` – seizoensvarianten van tables.

### 6.3 Encounter-tables

Structuur (conceptueel, voor `encounters.json`):

- `encounter_table_id`  
- `zone_id` (of `GLOBAL` + filters)  
- `entries`: lijst van mogelijke groepen met weging
  - `enemy_group_id`  
  - `weight`  
  - `min_level`, `max_level` (of scaling-regel)  
  - `time_band` (optioneel filter)  
  - `season_index` (optioneel filter)  
  - `story_required_flags` / `story_forbidden_flags`

Een **enemy_group** (in `enemy_groups.json`) definieert:

- 1–4 enemies, hun posities op het combat-grid, eventuele leader-tag.

### 6.4 Visible enemies (later)

Voor latere iteraties:

- Vijanden lopen rond met eigen **patrouille-patronen**.  
- Bij contact (of binnen zichtveld) → gevecht.  
- Encounter-type komt uit enemy_group of specifieke per-enemy-config.

Dit vraagt extra AI en pathfinding; is **niet nodig voor de eerste vertical slice**.

---

## 7. Overworld & NPC-schedules

De **NPC-schedules** uit 2.3 & 2.2 koppelen zich aan zones:

- Iedere NPC heeft een lijst entries: `(zone_id, path/patroon, time_band, day_type, season, festival_flag, storyflags)`.

In de OverworldScene:

- Bij zone-load worden alle NPC’s geladen die in deze zone **actief horen te zijn** op basis van `TimeState` en flags.  
- Bij overgang naar andere time_band (bv. DAY → DUSK) kan een **soft reload** plaatsvinden: NPC’s wisselen van positie/aanwezigheid.

Voor M1/M2:

- Houd het eenvoudig: 1–2 NPC’s met **dag/nacht-variant** (overdag op plein, ’s nachts thuis).  
- Later uitbreiden met seizoens- en festivalvarianten.

---

## 8. Travel & fast travel

### 8.1 Normale travel

- Speler loopt te voet tussen zones via portals (routes).  
- Reizen kost tijd (TimeState schuift mee).

### 8.2 Fast travel (QoL)

**Designbeslissingen (locked vanuit QoL-baseline):**

- Fast travel wordt alleen ontgrendeld naar **plekken die je al geweest bent**.  
- Niet overal: vooral hubs, belangrijke shrines, grote steden.

Mechanisch model:

- Vanuit bepaalde safe points (een inn, wagendienst, shrine) kan de speler kiezen uit bekende fast travel-punten.  
- Fast travel veroorzaakt een **tijdssprong** (TimeState vooruit) – b.v. een paar uren of halve dag.

In de vertical slice:

- Een eenvoudige fast travel is optioneel.  
- Minimale implementatie: 1 NPC in dorp die je als debug/feature naar shrine of route teleporteert (zonder lastige tijdslogica).

### 8.3 Toekomst – mounts/vehikels

Later kunnen we mounts/voertuigen (boot, karavaan) als aparte systemen toevoegen; dit spec bevestigt alleen dat **travel-snelheid en routekeuze** een rol spelen.

---

## 9. Savegame & world/time

Bij het saven slaan we op:

- `zone_id` – huidige zone.  
- `player_position` – tile-coördinaten.  
- `TimeState` – dag, tijd, seizoen, jaar.  
- Actieve `story_flags`, `npc_phases`, `quest_states`.

Bij load:

- Zone + player, TimeState worden exact hersteld.  
- NPC’s, encounters en events worden opnieuw geëvalueerd op basis van deze state.

Dit is cruciaal voor **trilogie-hooks**: de save van deel 1 bevat niet alleen stats, maar ook **wereld- en tijdcondities**.

---

## 10. Vertical Slice vs. volledige implementatie

### 10.1 Vertical Slice (M2) – minimale requirements

Voor M2 (vertical slice) is nodig:

- Minstens **2–3 zones in R1 Chandrapur**: dorp, een route/veld en een kleine shrine/dungeon.  
- Zone-data met: `zone_id`, `name`, `zone_type`, `encounter_table_id`, `safe_zone`, `tiled_map`.  
- Basis **dag/nacht-cyclus** (bijv. DAY / NIGHT) met tintwissel in overworld.  
- Een simpele **TimeState** die tijdens lopen en rusten voortschuift.  
- Random encounters in **minstens 1 zone** via een simpele encounter-table.  
- 1–2 eenvoudige NPC-schedules (dag/nacht) als bewijs dat tijd werkt.  
- Portals tussen dorp ↔ route ↔ shrine.

### 10.2 Volledige game

Later uitbreidingen omvatten:

- Volledig seizoenssysteem + kalender (events/festivals per regio).  
- Meerdere encounter-tables per zone (per time_band/season/queststate).  
- Complexere NPC-schedules (dagtype, festival, persoonlijke arc).  
- Fast travel met tijdssprongen.  
- Speciale portals naar astrale/speciale zones (R7 Tamoloka, R8 Akāshadhara).

Het huidige ontwerp is **vooruitcompatibel**: we hoeven de basisstructuur niet te breken om meer tijd/wereldlogica toe te voegen.

---

## 11. Relatie met andere artefacten

- **2.1 World & Regions Overview** – bepaalt welke regio’s/zones er zijn en wat hun rol is.  
- **2.2 Kalender & Festivals Spec** – definieert TimeState en de logica van dag/nacht/seizoenen/festivals waar deze spec op bouwt.  
- **2.3 NPC Cast & Fasen** – bepaalt welke NPC’s waar en wanneer leven, en hoe hun fases met zones meekoppelen.  
- **2.4 Quest Taxonomy & Voorbeeldlijst** – levert quests die zone-, tijd- en eventcondities gebruiken.  
- **Scenes & State Flow** – beschrijft hoe OverworldScene ↔ BattleScene ↔ MenuScene overgang werkt.  
- **4.x Data & Schema’s** – `zones.schema.json`, `encounters.schema.json`, `events.schema.json`, `npc_schedules.schema.json`, `savegame.schema.json` implementeren de hier beschreven velden.

Versie 0.1 legt de **brug** tussen tijd, wereld en overworld-ervaring: lopen, zien, tegenkomen. Later tuning en uitbouw (meer seizoenen, meer eventtypen) verandert de cijfers en lijsten, maar niet de basisstructuur.